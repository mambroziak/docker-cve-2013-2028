#!/bin/bash
if [ "$(dig +short -t a kube-dns.kube-system.svc.cluster.local.)" ] 
then
  sed -i 's/#{{k8s_dns}}/resolver kube-dns.kube-system.svc.cluster.local valid=10s;/' /etc/nginx/conf.d/default.conf
fi

echo "---------STARTING ADDITIONAL entrypoints--------"
if [ -f $VSP_ENTRYPOINT_DIR/entrypoint_virsec.sh ]; then
echo $VSP_ENTRYPOINT_DIR/entrypoint_virsec.sh
$VSP_ENTRYPOINT_DIR/entrypoint_virsec.sh
else
echo "No ADDITIONAL entrypoints found in $VSP_ENTRYPOINT_DIR"
fi
echo "---------DONE STARTING ADDITIONAL entrypoints--------"

/usr/sbin/nginx
#/usr/sbin/nginx -s reload

tail -f /dev/null
