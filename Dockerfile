FROM centos:6.7
WORKDIR /tmp
ENV TZ=America/New_York
ENV PATH /opt/gitlab/embedded/bin:/opt/gitlab/bin:/assets:$PATH
COPY . .

RUN \cp  ./CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo 
RUN yum update -y && yum install -y tar wget unzip initscripts sudo
RUN chkconfig iptables off
RUN rpm -ivH ./nginx/nginx-1.4.0-1.el6.ngx.x86_64.rpm
RUN service nginx stop
RUN chmod +x ./nginx/nginx && \cp ./nginx/nginx /usr/sbin/nginx && \cp ./nginx/nginx.conf /etc/nginx/
RUN mkdir -p /usr/local/nginx/logs
RUN chkconfig nginx on && service nginx start
RUN \cp ./sudoers /etc/sudoers
RUN service nginx stop
RUN rm -f /var/lock/subsys/nginx

CMD ["sh", "-c", "service nginx start; while true; do sleep 30; done;"]